Steps to create an Apollo server with typescript 

**1- Define the schema:**
-

 -  we define the schema using the `type`  annotation and define each type String,Int, Boolean or ID. 
 - If there are a relation between types we define them in the schema
  eg:
  ``` 
  type Book {
    title: String,
    price: Int,
    author: Author  // relation with the Author type
  }
  type Author{
    name: String,
    email: string,
    books: [Book] // relation with the Book type
  }
```

 **2- Define the endpoints:** 
 -
   We use type `Query` to define the endpoints 
   ```
   type Query {
    books: [Book],
    book(ld: ID!) : Book, 
    authors: [Author],
    author(id: ID!) : [Authors!]!  
   }
  ```
 
 ** 3- Define the resolvers:** 
 - 

   - Resolvers are responsible for populating the data for a field in the schema, it should be focused on retrieving only the data it's responsible for. 
   - Resolvers can be defined for every field in our schema. When a resolver exists for a particular field on a type, responsibility for returning that data is automatically delegated to it.

   - Resolver is a function, it's name must match the name of the field in the query. this function always receive four params (parent, args, contextValue, info)

   ```
   const resolvers: {
    books: (parent, args, context, info)=> {
        ///logic to return a book
    }
    book(parent, args, context, info)=> {
        const id = args.id;
        return // logic to find book with the id
    }
   }
 ```
   **4- Define DB instance**
   - 

   DB could be any type of data *eg: REST API, mongoDB*, In this example we created a class with helper methods to call the data and retrieve it. 
   Then we use it  in the resolvers. 
we use a package called `@apollo/datasource-rest`
```
import { RESTDataSource } from '@apollo/datasource-rest'; 
class SpotifyAPI extends RESTDataSource {
    async getAllBooks(){ 
       return this.get<Book>("${api endpoint}")
    }
    async getAllAuthors(){}
}
```
   **5- Use Code-gen to generate types automatically**  
   - 
- Code-gen is a package to help us define the typescript types from the schema.
- we need to install these packages 

```
npm install -D @graphql-codegen/cli @graphql-codegen/typescript @graphql-codegen/typescript-resolvers
```

we need to run the command below to init the code-gen file 
``` 
npx graphql-code-generator init
```
If the data returned from the Backend is in a different structure from the schema, we can create `models` to match the BE schema and them map it to the graphQL schema using the `mappers` key in the `code-gen.ts` file  

***important:***  paths in the codegen.ts must be relative to the generated types path in generated by code-gen  

**6- use Models to match BE REST API schema**
- 
- We can use models to represent the shape of our backend objects.
- In the codegen process, we use the `mappers` property to specify which GraphQL type a model should map to.
- By mapping PlaylistModel to the Playlist type, our resolvers that expect to receive a Playlist object as their parent argument (such as Playlist.tracks) can access all of the properties that exist on PlaylistModel without type errors.
- Resolvers can be defined for every field in our schema. When a resolver exists for a particular field on a type, responsibility for returning that data is automatically delegated to it.

**7- install codegen on the client side:**
-
[steps to setup apollo on FE side](https://www.apollographql.com/tutorials/lift-off-part1/08-apollo-client-setup)
- Create a client folder and init a react app in it.
- we need to install a few packages in the client folder
```
npm i @apollo/client graphql @graphql-codegen/cli @graphql-codegen/client-preset
```
- Create an Apollo client and wrapp `React tree`  with the provider


<details> 
<summary>  click to see apollo server code on the FE side
</summary>

```
import { ApolloClient, InMemoryCache, ApolloProvider } from '@apollo/client';

const client = new ApolloClient({
  uri: 'http://localhost:4000',
  cache: new InMemoryCache(),

  root.render(
  <React.StrictMode>
   + <ApolloProvider client={client}>
      <GlobalStyles />
      <Pages />
    + </ApolloProvider>
  </React.StrictMode>
);
});

```
</details>

-

- install codegen on the frontend side to generate typescript types from the graphql server

```
npm install -D @graphql-codegen/cli @graphql-codegen/client-preset
```

 - run the command below to init `codegen.ts` file
 ```
 npm graphql-code-generator  init
 ```
<details>
<summary> click see codegen.ts example on the client side </summary> 

```
import type { CodegenConfig } from '@graphql-codegen/cli';

const config: CodegenConfig = {
  overwrite: true,
  schema: 'http://localhost:4000',
  documents: 'src/**/*.tsx',
  generates: {
    './src/__generated__/': {
      plugins: [],
      preset: 'client',
      presetConfig: {
        gqlTagName: 'gql',
      },
    },
  },
  ignoreNoDocuments: true,
};

export default config;

```
</details>
